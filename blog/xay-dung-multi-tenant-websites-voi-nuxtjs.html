<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Xây dựng multi-tenant websites với NuxtJS</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/288e6fce7d19ad979b67.css" as="style"/><link rel="stylesheet" href="/_next/static/css/288e6fce7d19ad979b67.css" data-n-g=""/><link rel="preload" href="/_next/static/css/cd7d7fff9e98be66a830.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cd7d7fff9e98be66a830.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-af8d060cb140570bcfb2.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework-92300432a1172ef1338b.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-899697ea82bdc85e7a94.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-5f22d077be68381df9e9.js" as="script"/><link rel="preload" href="/_next/static/chunks/571-41b2c65dc001313f5918.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/%5Bslug%5D-ba501843032cf0ceb4ed.js" as="script"/></head><body><div id="__next"><div><nav class="container py-4 flex items-center justify-between lg:justify-start mb-2" aria-label="Global"><div class="flex items-center flex-grow flex-shrink-0 lg:flex-grow-0"><div class="flex items-center justify-between w-full md:w-auto"><a class="index-link active" href="/"><div class="flex items-center"><div><h2 class="text-2xl">Hieu Tran</h2><blockquote>Product oriented developer</blockquote></div></div></a></div></div><nav id="navigation" class="fixed inset-0 bg-white z-10 flex items-center justify-center	 hidden"><div class="flex flex-col nav-items styles_nav-items__1aEZC"><a class="font-medium text-gray-500 hover:text-gray-900 px-4 index-link active" href="/">Home</a><a class="font-medium text-gray-500 hover:text-gray-900 px-4" href="/portfolio">Portfolio</a><a class="font-medium text-gray-500 hover:text-gray-900 px-4" href="/resume">Resume</a></div></nav></nav></div><div><header><div class="mb-12 text-center"><dl><div><dt class="sr-only">Published on</dt><dd class="text-base leading-6 font-medium text-gray-500"><time dateTime="2021-02-21T08:35:07.322Z">February 21, 2021</time></dd></div></dl><div><h2 class="text-2xl leading-9 font-medium text-gray-700 tracking-tight sm:text-3xl sm:leading-10 md:text-5xl md:leading-14">Xây dựng multi-tenant websites với NuxtJS</h2></div></div></header><article class="max-w-2xl mx-auto"><div><div class="mb-8 md:mb-8 sm:mx-0"><img src="/images/george-becker-129494.jpg" alt="Xây dựng multi-tenant websites với NuxtJS&#x27;s cover" class="shadow-small hover:shadow-medium transition-shadow duration-200"/></div><div class="styles_markdown__3B93I"><p>Về bối cách thực tế trong thời Covid, bán hàng online nở rộ, cửa hàng bánh mình đang làm thêm cũng gặp nhiều khó khăn trong bán hàng, mình nảy ra ý định xây trang web để bán bánh online giúp cửa hàng có thêm doanh thu. Khi về gặp đứa bạn chuyên bán hàng online để tìm hiểu nhu cầu thực tế và cách triển khai thì cũng được biết là bạn mình cũng muốn có trang web riêng để có thêm kênh bán hàng, và mình cũng gạ để mình làm cho luôn.</p>
<p>Đầu tiên mọi người đều sẽ hỏi sao không dùng mấy dịch vụ SaaS có sẵn như Shopify, Sapo… hay cài đặt Wordpress, Magento… nhỉ? Thật ra là một developer thì luôn luôn có suy nghĩ tự làm tự code từ đầu, chưa có sự thực dụng và nhạy bén trong kinh doanh và mình cũng tự tin là có thể làm ra những sản phẩm có nền tảng công nghệ tốt nhất nên là về mặt tinh thần là làm thôi, làm còn để học thêm nữa. Và ngoài ra thì với việc sử dụng SaaS mình cũng không có toàn quyền tuỳ chỉnh, dữ liệu thì cũng bị phụ thuộc, sử dụng mã nguồn mở thì đôi khi nó có quá nhiều thứ mình không hoặc chưa cần đến. Với những sản phẩm mã nguồn mở phổ biến kể trên như Wordpress hay Magento thì mình cũng đã đều dùng thử, công nhận là hệ thống plugins dày đặc cũng hỗ trợ mọi thứ từ A-Z sẽ là một giải pháp hoàn hảo nếu mình thuần phát triển kinh doanh. Đặc điểm của những mã nguồn kể trên phần giao diện vẫn là thuần server render một khối, những tính năng tương tác thường sẽ phát triển theo hệ jQuery. Mình thì mong muốn sử dụng những framework, library hiện đại như React hay Vue để xây dựng hơn.</p>
<p>Ở bài này mình sẽ tập trung vào phần phát triển front end, và làm sao để hỗ trợ chạy nhiều trang web trên cùng một server instance theo dạng multi-tenant để mình có thể dễ dàng làm thêm nhiều trang web nhanh chóng dễ dàng, mà vẫn đảm bảo sự tùy biến cần thiết, vì rất có thể ngoài những trang bán hàng kể trên mình sẽ làm thêm những trang tin tức, blog, landing page cho mình hoặc cho người thân thậm chí cho cả người ngoài với chi phí tiết kiệm.</p>
<p>Với đề bài ban đầu đặt ra là làm một trang web bán hàng, thì mình nghĩ ngay đến những yêu cầu công nghệ như sau:</p>
<ul>
<li>Server side rendering (mình muốn có trải nghiệm tốt và hỗ trợ SEO).</li>
<li>Có dashboard cho việc quản lý bán hàng, SPA thôi là đủ.</li>
<li>Để có trải nghiệm tốt thì mình sẽ làm cả bản mobile và desktop riêng, giao diện responsive chỉ để gọi là tránh vỡ.</li>
<li>Chia sẻ được UI component nhiều nhất có thể.</li>
<li>PWA</li>
</ul>
<p>Có 2 ứng cử viên cho framework sử dụng đó là NextJS và NuxtJS cũng là đại diện cho React và Vue. Mình đã từng sử dụng cả 2 frameworks này rồi thì có mấy cân nhắc như sau:</p>
<ul>
<li>Đối với NextJS, gần đây nó có rất nhiều thay đổi và cải thiện tích cực về performance cũng như trải nghiệm dev, từ cơ chế SSG, tối ưu hình ảnh, React hỗ trợ Typescript tốt… nói chung là hoàn hảo để xây trang ecommerce.</li>
<li>NuxtJS thì cũng là 1 framework yêu thích của mình với khả năng tuỳ biến cao qua những file configs, modules đa dạng. Nhưng có điều hiện giờ vẫn chưa chính thức hỗ trợ Vue 3 mới nhất. Cảm giác của mình là lo sợ khi làm xong thì nó lại nâng version mới.</li>
</ul>
<p>Ban đầu mình cũng khá nghiêng về sử dụng NextJS và cũng thử init project, tuỳ biến để có thể hỗ trợ multi-tenant theo từng subfolders trong folder pages/. Đối với NextJS, có 2 phần việc chính phải làm là custom NextJS server để map lại những routes theo tenant, phần này khá dễ. Sửa đến đây khi chạy server lên sẽ không thấy gì, mở developer tools ra thì sẽ thấy hiện lỗi 404 khi NextJS cần load những thông tin props, manifest, khi này mình có view source lên thì thấy hiện đúng nội dung, chứng tỏ việc server side rendering diễn ra bình thường, vậy là vấn để xảy ra trong quá trình client side rehydration, để sửa cho phần này mình cần map lại những chỗ NextJS lấy thông tin props, manifest để hiển thị, mình cũng có Google thì cơ bản là NextJS không sinh ra cho việc này, rồi gạ dùng Vercel Mutli Zones. Chỉ còn cách sửa vào core của NextJS rồi, mò mấy hôm thì cũng sửa được nhưng việc sửa vào core khá mệt, do mình cần beautify rồi mò từng chỗ, việc folk lại cũng mệt không kém bởi vì NextJS đang trong giai đoạn active development. (Hiện giờ khi viết bài này thì mình biết là có cách khách để mokey-patching runtime)</p>
<p>Và cuối cùng mình đã quyết định dùng NuxtJS, bản thân hệ thống route của NuxtJS dựa trên Vue Router nên việc cài đặt cũng không quá khó, ngoài ra còn có thể dễ dàng viết thêm plugins mà không cần sửa core. Ý tưởng của mình cũng là sẽ tạo các folder tương ứng với các tenant nằm trong folder pages/ của Nuxt, rồi từ domain sẽ quyết định load folder nào trong folder pages. Cách thực hiện khá đơn giản, chỉ cần từ domain sẽ build lại route configs ứng theo từng tenant. Mình có làm 1 cái <a href="https://github.com/hieuhani/nuxt-multi-tenancy-module" title="module đơn giản ở đây">module đơn giản ở đây</a> cho việc này.
Tiếp theo đặt tenant trong folder pages nghe cũng không xịn, (NuxtJS sử dụng file-based routes) vậy nên mình muốn đổi tên thành folder sites. Thật may mắn vì NuxtJS cho đổi tên folder pages một cách dễ dàng qua <a href="https://nuxtjs.org/docs/2.x/directory-structure/nuxt-config/#dir" title="Nuxt config">Nuxt config</a>.</p>
<p>Đối với Nuxt mình cũng có thể linh hoạt quyết định trang nào SSR trang nào CSR một cách đơn giản dễ dàng thông qua Nuxt config hoặc Nuxt middleware, hoặc đặt trong component client-only.</p>
<p>Sau khi đã hoàn thành việc hỗ trợ multi-tenant qua việc map tên miền với tệp các routes tương ứng trong folder sites thì mình đã tự tin hơn cho ý tưởng này.</p>
<p>Tiếp theo trong quá trình làm thì mình nhận thấy giữa các trang web có rất nhiều điểm giống nhau, khác nhau có lẽ là đôi chút màu sắc, typography, vì vậy lại nghĩ đến giải pháp dài hơi hơn là cấu trúc để làm sao sử dụng lại được nhiều nhất, nghĩ ngay đến làm theme và xây bộ UI components.</p>
</div></div></article></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Xây dựng multi-tenant websites với NuxtJS","excerpt":"Multi-tenant websites cho phép chúng ta chạy nhiều websites trên cùng một server instance với nhiều lợi ích giúp tiết kiệm tài nguyên server và chi phí cũng như thời gian phát triển. Hôm nay mình sẽ chia sẻ về cách mình xây dựng hệ thống nhiều websites này.","coverImage":"/images/george-becker-129494.jpg","date":"2021-02-21T08:35:07.322Z","content":"\u003cp\u003eVề bối cách thực tế trong thời Covid, bán hàng online nở rộ, cửa hàng bánh mình đang làm thêm cũng gặp nhiều khó khăn trong bán hàng, mình nảy ra ý định xây trang web để bán bánh online giúp cửa hàng có thêm doanh thu. Khi về gặp đứa bạn chuyên bán hàng online để tìm hiểu nhu cầu thực tế và cách triển khai thì cũng được biết là bạn mình cũng muốn có trang web riêng để có thêm kênh bán hàng, và mình cũng gạ để mình làm cho luôn.\u003c/p\u003e\n\u003cp\u003eĐầu tiên mọi người đều sẽ hỏi sao không dùng mấy dịch vụ SaaS có sẵn như Shopify, Sapo… hay cài đặt Wordpress, Magento… nhỉ? Thật ra là một developer thì luôn luôn có suy nghĩ tự làm tự code từ đầu, chưa có sự thực dụng và nhạy bén trong kinh doanh và mình cũng tự tin là có thể làm ra những sản phẩm có nền tảng công nghệ tốt nhất nên là về mặt tinh thần là làm thôi, làm còn để học thêm nữa. Và ngoài ra thì với việc sử dụng SaaS mình cũng không có toàn quyền tuỳ chỉnh, dữ liệu thì cũng bị phụ thuộc, sử dụng mã nguồn mở thì đôi khi nó có quá nhiều thứ mình không hoặc chưa cần đến. Với những sản phẩm mã nguồn mở phổ biến kể trên như Wordpress hay Magento thì mình cũng đã đều dùng thử, công nhận là hệ thống plugins dày đặc cũng hỗ trợ mọi thứ từ A-Z sẽ là một giải pháp hoàn hảo nếu mình thuần phát triển kinh doanh. Đặc điểm của những mã nguồn kể trên phần giao diện vẫn là thuần server render một khối, những tính năng tương tác thường sẽ phát triển theo hệ jQuery. Mình thì mong muốn sử dụng những framework, library hiện đại như React hay Vue để xây dựng hơn.\u003c/p\u003e\n\u003cp\u003eỞ bài này mình sẽ tập trung vào phần phát triển front end, và làm sao để hỗ trợ chạy nhiều trang web trên cùng một server instance theo dạng multi-tenant để mình có thể dễ dàng làm thêm nhiều trang web nhanh chóng dễ dàng, mà vẫn đảm bảo sự tùy biến cần thiết, vì rất có thể ngoài những trang bán hàng kể trên mình sẽ làm thêm những trang tin tức, blog, landing page cho mình hoặc cho người thân thậm chí cho cả người ngoài với chi phí tiết kiệm.\u003c/p\u003e\n\u003cp\u003eVới đề bài ban đầu đặt ra là làm một trang web bán hàng, thì mình nghĩ ngay đến những yêu cầu công nghệ như sau:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eServer side rendering (mình muốn có trải nghiệm tốt và hỗ trợ SEO).\u003c/li\u003e\n\u003cli\u003eCó dashboard cho việc quản lý bán hàng, SPA thôi là đủ.\u003c/li\u003e\n\u003cli\u003eĐể có trải nghiệm tốt thì mình sẽ làm cả bản mobile và desktop riêng, giao diện responsive chỉ để gọi là tránh vỡ.\u003c/li\u003e\n\u003cli\u003eChia sẻ được UI component nhiều nhất có thể.\u003c/li\u003e\n\u003cli\u003ePWA\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eCó 2 ứng cử viên cho framework sử dụng đó là NextJS và NuxtJS cũng là đại diện cho React và Vue. Mình đã từng sử dụng cả 2 frameworks này rồi thì có mấy cân nhắc như sau:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eĐối với NextJS, gần đây nó có rất nhiều thay đổi và cải thiện tích cực về performance cũng như trải nghiệm dev, từ cơ chế SSG, tối ưu hình ảnh, React hỗ trợ Typescript tốt… nói chung là hoàn hảo để xây trang ecommerce.\u003c/li\u003e\n\u003cli\u003eNuxtJS thì cũng là 1 framework yêu thích của mình với khả năng tuỳ biến cao qua những file configs, modules đa dạng. Nhưng có điều hiện giờ vẫn chưa chính thức hỗ trợ Vue 3 mới nhất. Cảm giác của mình là lo sợ khi làm xong thì nó lại nâng version mới.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eBan đầu mình cũng khá nghiêng về sử dụng NextJS và cũng thử init project, tuỳ biến để có thể hỗ trợ multi-tenant theo từng subfolders trong folder pages/. Đối với NextJS, có 2 phần việc chính phải làm là custom NextJS server để map lại những routes theo tenant, phần này khá dễ. Sửa đến đây khi chạy server lên sẽ không thấy gì, mở developer tools ra thì sẽ thấy hiện lỗi 404 khi NextJS cần load những thông tin props, manifest, khi này mình có view source lên thì thấy hiện đúng nội dung, chứng tỏ việc server side rendering diễn ra bình thường, vậy là vấn để xảy ra trong quá trình client side rehydration, để sửa cho phần này mình cần map lại những chỗ NextJS lấy thông tin props, manifest để hiển thị, mình cũng có Google thì cơ bản là NextJS không sinh ra cho việc này, rồi gạ dùng Vercel Mutli Zones. Chỉ còn cách sửa vào core của NextJS rồi, mò mấy hôm thì cũng sửa được nhưng việc sửa vào core khá mệt, do mình cần beautify rồi mò từng chỗ, việc folk lại cũng mệt không kém bởi vì NextJS đang trong giai đoạn active development. (Hiện giờ khi viết bài này thì mình biết là có cách khách để mokey-patching runtime)\u003c/p\u003e\n\u003cp\u003eVà cuối cùng mình đã quyết định dùng NuxtJS, bản thân hệ thống route của NuxtJS dựa trên Vue Router nên việc cài đặt cũng không quá khó, ngoài ra còn có thể dễ dàng viết thêm plugins mà không cần sửa core. Ý tưởng của mình cũng là sẽ tạo các folder tương ứng với các tenant nằm trong folder pages/ của Nuxt, rồi từ domain sẽ quyết định load folder nào trong folder pages. Cách thực hiện khá đơn giản, chỉ cần từ domain sẽ build lại route configs ứng theo từng tenant. Mình có làm 1 cái \u003ca href=\"https://github.com/hieuhani/nuxt-multi-tenancy-module\" title=\"module đơn giản ở đây\"\u003emodule đơn giản ở đây\u003c/a\u003e cho việc này.\nTiếp theo đặt tenant trong folder pages nghe cũng không xịn, (NuxtJS sử dụng file-based routes) vậy nên mình muốn đổi tên thành folder sites. Thật may mắn vì NuxtJS cho đổi tên folder pages một cách dễ dàng qua \u003ca href=\"https://nuxtjs.org/docs/2.x/directory-structure/nuxt-config/#dir\" title=\"Nuxt config\"\u003eNuxt config\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eĐối với Nuxt mình cũng có thể linh hoạt quyết định trang nào SSR trang nào CSR một cách đơn giản dễ dàng thông qua Nuxt config hoặc Nuxt middleware, hoặc đặt trong component client-only.\u003c/p\u003e\n\u003cp\u003eSau khi đã hoàn thành việc hỗ trợ multi-tenant qua việc map tên miền với tệp các routes tương ứng trong folder sites thì mình đã tự tin hơn cho ý tưởng này.\u003c/p\u003e\n\u003cp\u003eTiếp theo trong quá trình làm thì mình nhận thấy giữa các trang web có rất nhiều điểm giống nhau, khác nhau có lẽ là đôi chút màu sắc, typography, vì vậy lại nghĩ đến giải pháp dài hơi hơn là cấu trúc để làm sao sử dụng lại được nhiều nhất, nghĩ ngay đến làm theme và xây bộ UI components.\u003c/p\u003e\n","slug":"xay-dung-multi-tenant-websites-voi-nuxtjs"}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"xay-dung-multi-tenant-websites-voi-nuxtjs"},"buildId":"c04NSBCZX34a7lXMdRa-j","isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-eef578260fd80f8fff94.js"></script><script src="/_next/static/chunks/webpack-af8d060cb140570bcfb2.js" async=""></script><script src="/_next/static/chunks/framework-92300432a1172ef1338b.js" async=""></script><script src="/_next/static/chunks/main-899697ea82bdc85e7a94.js" async=""></script><script src="/_next/static/chunks/pages/_app-5f22d077be68381df9e9.js" async=""></script><script src="/_next/static/chunks/571-41b2c65dc001313f5918.js" async=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-ba501843032cf0ceb4ed.js" async=""></script><script src="/_next/static/c04NSBCZX34a7lXMdRa-j/_buildManifest.js" async=""></script><script src="/_next/static/c04NSBCZX34a7lXMdRa-j/_ssgManifest.js" async=""></script></body></html>